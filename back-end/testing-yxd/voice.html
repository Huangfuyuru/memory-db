<!DOCTYPE html>
<html lang="en">

    <head>
      <title>THU Audio</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css" />
      <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
     
      <script  src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script  src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"></script>
     
    </head>
     
   <body>
     <!-- 把文件存入内存中预听 -->
      <span>Browse files</span>
      <form id = 'form1'>

        <input type="file" id="browse-button" accept="audio/*">
      </form>
    <div class="card uf-card">
      <span>source audio</span>
      <audio id="img-card"  controls></audio><br>
    </div>
  

</html>

<script>

 loadAudio = function(file) {
  var reader = new FileReader();
  reader.onload = function(event) {
    $('#img-card').attr('src', event.target.result);
  };
  reader.readAsDataURL(file);
};


  $("#browse-button").change(function() {
    //console.log($("#browse-button").prop("files")[0])
    loadAudio($("#browse-button").prop("files")[0]);
    var from1 = $('#from1');
      var data=$("#browse-button").prop("files")[0];
      
      var formData = new FormData(form1);
      // 第一个是字段name，第二个参数是二进制的文件本体，第三个参数是filename
      formData.append('uploadfile',data, data.name)
      console.log('upload',formData.get('uploadfile'))
      var url ='http://localhost:3001/sound';
      // fetch(url,{
      //   method:'POST',
      //   headers: {'Content-Type': 'multipart/form-data'},
      //   body:formData,
      //   dataType: 'JSON',
      // }).then(res=>res.json())
      // .then(res=>{
      //   console.log(res)
      // })
    });

    // $('#upload-button').click(function() {
    //   var url ='http://localhost:3001/sound';

    //   fetch(url,{
    //     method:'POST',
    //     body:{
    //       'image64':$('#img-card').attr('src')
    //     },
    //     dataType:'text'
    //   }).then(res=>res.json())
    //   .then(res=>{
    //     console.log(res)
    //   })
    // })

</script>